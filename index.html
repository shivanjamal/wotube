<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WOTUBE | Bi xêr hatî</title>

  <!-- ADSENSE SCRIPT START -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8356023561241179"
     crossorigin="anonymous"></script>
  <!-- ADSENSE SCRIPT END -->

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <style>
    :root {
      --bg-color: #f7f7f7; --surface-color: #ffffff;
      --primary-accent: #6a8bab; --text-color: #2c3e50;
      --line-color: #e0e0e0; --danger-color: #e74c3c;
    }
    body {
      font-family: 'Inter', sans-serif; background-color: var(--bg-color);
      color: var(--text-color); margin: 0; padding: 24px;
    }
    
    /* === Auth Page Styles === */
    #authPage {
        display: none; align-items: center; justify-content: center;
        min-height: 100vh;
    }
    .auth-container {
        background-color: var(--surface-color); border: 1px solid var(--line-color);
        border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.08);
        padding: 40px; width: 100%; max-width: 400px; text-align: center;
    }
    .auth-container h2 { font-size: 2.5rem; font-weight: 900; margin: 0 0 30px 0; }
    .auth-form input {
        width: 100%; box-sizing: border-box; background-color: var(--bg-color);
        border: 2px solid var(--line-color); border-radius: 12px; padding: 18px;
        margin-bottom: 15px; font-family: 'Inter', sans-serif; font-weight: 700;
        font-size: 1rem; color: var(--text-color); text-align: center;
    }
    .auth-form button {
        width: 100%; padding: 18px; background-color: var(--primary-accent);
        border: none; border-radius: 12px; color: #fff; font-weight: 700;
        font-size: 1.1rem; cursor: pointer; margin-top: 10px;
        transition: background-color 0.3s;
    }
    .auth-form button:hover { background-color: #55728e; }
    .auth-toggle-link { margin-top: 20px; font-weight: 700; }
    .auth-toggle-link span { cursor: pointer; color: var(--primary-accent); }
    .error-message { color: var(--danger-color); font-weight: 700; margin-bottom: 15px; display: none; min-height: 20px; }

    /* === Main App Styles === */
    #mainApp { display: none; }
    .content-wrapper { max-width: 600px; margin: 0 auto; }
    header {
        padding: 10px 0 20px 0; display: flex;
        justify-content: space-between; align-items: center;
        border-bottom: 1px solid var(--line-color); margin-bottom: 30px;
    }
    .header-left { display: flex; align-items: center; gap: 10px; }
    #logo { font-size: 2rem; font-weight: 900; }
    .header-right { display: flex; align-items: center; gap: 20px; }
    #userProfileIcon { font-size: 2rem; color: var(--text-color); opacity: 0.7; cursor: default; }
    #logoutBtn { background: none; border: 2px solid var(--line-color); color: #7f8c8d; font-weight: 700; padding: 8px 15px; cursor: pointer; border-radius: 8px; }
    
    #searchSection { margin-bottom: 30px; }
    .search-input-wrapper {
        position: relative; background-color: var(--surface-color);
        border: 2px solid var(--line-color); border-radius: 12px;
        display: flex; align-items: center;
    }
    #searchQuery { width: 100%; flex-grow: 1; border: none; outline: none; background: transparent; color: var(--text-color); font-size: 1.2rem; font-weight: 700; padding: 20px; padding-left: 60px; }
    #searchBtnIcon {
        position: absolute; left: 20px; top: 50%;
        transform: translateY(-50%); font-size: 1.3rem;
        color: var(--text-color); opacity: 0.4;
        cursor: pointer; transition: opacity 0.3s;
    }
    #searchBtnIcon:hover { opacity: 1; }

    #results { display: grid; grid-template-columns: 1fr; gap: 30px; padding-bottom: 40px; }
    .video-card { background-color: var(--surface-color); border-radius: 16px; box-shadow: 0 5px 25px rgba(0,0,0,0.05); overflow: hidden; animation: popIn 0.5s ease-out backwards; }
    .video-card iframe { width: 100%; height: 220px; border: none; display: block; }
    .video-card-content { padding: 20px; }
    .video-card h4 { margin: 0 0 10px 0; font-weight: 700; font-size: 1.1rem; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .video-info { display: flex; justify-content: space-between; font-size: 0.9rem; opacity: 0.7; }
    .message { text-align: center; padding: 40px 20px; font-size: 1.5rem; font-weight: 700; color: #bdc3c7; }
    .loader { text-align: center; font-weight: 700; font-size: 1.2rem; color: var(--primary-accent); padding: 50px 0; }
    footer { text-align: center; padding: 30px 0; border-top: 1px solid var(--line-color); margin-top: 20px; }
    @keyframes popIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>
  
  <div id="authPage">
      <div id="loginContainer" class="auth-container">
          <h2>بچۆرە ژۆر</h2>
          <form id="loginForm" class="auth-form">
              <p id="loginError" class="error-message"></p>
              <input type="email" id="loginEmail" placeholder="ئیمەیل" required>
              <input type="password" id="loginPassword" placeholder="پاسوۆرد" required>
              <button type="submit">چوونا ژۆر</button>
          </form>
          <p class="auth-toggle-link">هژمارا تە نینە؟ <span id="showRegister">ئێکێ دروست بکە</span></p>
      </div>
      <div id="registerContainer" class="auth-container" style="display: none;">
          <h2>هژمارەکا نوو</h2>
          <form id="registerForm" class="auth-form">
              <p id="registerError" class="error-message"></p>
              <input type="email" id="registerEmail" placeholder="ئیمەیل" required>
              <input type="password" id="registerPassword" placeholder="پاسوۆرد (ل کێم ٦ پیت)" required>
              <button type="submit">تۆمارکرن</button>
          </form>
          <p class="auth-toggle-link">هژمارا تە هەیە؟ <span id="showLogin">بچۆرە ژۆر</span></p>
      </div>
  </div>

  <div id="mainApp">
      <div class="content-wrapper">
          <header>
              <div class="header-left"> <h1 id="logo">WOTUBE</h1> </div>
              <div class="header-right">
                  <i id="userProfileIcon" class="fas fa-user-circle"></i>
                  <button id="logoutBtn">دەرکەفتن</button>
              </div>
          </header>
          <main>
              <section id="searchSection">
                  <div class="search-input-wrapper">
                      <i id="searchBtnIcon" class="fas fa-search"></i>
                      <input id="searchQuery" type="text" placeholder="ل تشەکێ بگەڕێ..." />
                  </div>
              </section>
              <div id="results"></div>
          </main>
          <footer> <!-- Footer content --> </footer>
      </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    
    const firebaseConfig = {
      apiKey: "AIzaSyATs9VJTzGOznmA_3ptKUs36CpXwWTWaV0",
      authDomain: "tubebase-b0c38.firebaseapp.com",
      projectId: "tubebase-b0c38",
      storageBucket: "tubebase-b0c38.appspot.com",
      messagingSenderId: "961600428034",
      appId: "1:961600428034:web:17e1398d5c39cd55852f1b",
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // --- DOM Elements ---
    const authPage = document.getElementById('authPage');
    const mainApp = document.getElementById('mainApp');
    const userProfileIcon = document.getElementById('userProfileIcon');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginContainer = document.getElementById('loginContainer');
    const registerContainer = document.getElementById('registerContainer');
    const showRegister = document.getElementById('showRegister');
    const showLogin = document.getElementById('showLogin');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const loginError = document.getElementById('loginError');
    const registerError = document.getElementById('registerError');
    const resultsDiv = document.getElementById('results');
    const searchBtn = document.getElementById('searchBtnIcon');
    const searchQueryInput = document.getElementById('searchQuery');
    
    // --- Auth State Observer ---
    onAuthStateChanged(auth, user => {
        if (user) {
            authPage.style.display = 'none';
            mainApp.style.display = 'block';
            userProfileIcon.title = user.email; // Set email as a tooltip
            if (!resultsDiv.innerHTML.trim()) {
                fetchTrending();
            }
        } else {
            authPage.style.display = 'flex';
            mainApp.style.display = 'none';
        }
    });

    // --- Auth Event Listeners ---
    showRegister.addEventListener('click', () => { loginContainer.style.display = 'none'; registerContainer.style.display = 'block'; });
    showLogin.addEventListener('click', () => { registerContainer.style.display = 'none'; loginContainer.style.display = 'block'; });
    registerForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        registerError.style.display = 'none';
        createUserWithEmailAndPassword(auth, email, password)
            .then(() => {
                alert('هژمارا تە ب سەرکەفتی هاتە دروستکرن! نوکە بچۆرە ژۆر.');
                showLogin.click();
                registerForm.reset();
            })
            .catch(error => {
                if(error.code === 'auth/email-already-in-use') {
                    registerError.textContent = 'ئەڤ ئیمەیلە یێ تۆمارکریە.';
                } else if (error.code === 'auth/weak-password') {
                    registerError.textContent = 'پاسوۆرد پێدڤیە ل کێم ٦ پیت بن.';
                } else {
                    registerError.textContent = 'کێشەیەک روویدا.';
                }
                registerError.style.display = 'block';
            });
    });
    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        loginError.style.display = 'none';
        signInWithEmailAndPassword(auth, email, password)
            .catch(error => {
                loginError.textContent = 'ئیمەیل یان پاسوۆرد خەلەتە.';
                loginError.style.display = 'block';
            });
    });
    logoutBtn.addEventListener('click', () => { signOut(auth); });

    // --- YouTube Search App Logic ---
    const youtubeApiKey = 'AIzaSyBad6ylBa2aVEYUfTYCLlxIP8FFFJ8ToAI';
    let loading = false;
    
    async function performSearch(query) {
        if (loading || !youtubeApiKey || youtubeApiKey === 'Your_API_Key_Here') { showMessage('کلیلێ API یێ پێدڤیە.'); return; }
        loading = true; showLoader();
        try {
            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=15&type=video&q=${encodeURIComponent(query)}&key=${youtubeApiKey}`;
            const response = await fetch(url);
            const data = await response.json();
            resultsDiv.innerHTML = '';
            if (data.error) { showMessage('کێشەیەک د ئینانا ئەنجامان دا هەیە.'); return; }
            if (data.items.length === 0) { showMessage(`هیچ ئەنجامەک بۆ "${query}" نەهاتە دیتن.`); return; }
            data.items.forEach((video, index) => resultsDiv.appendChild(createVideoCard(video, index)));
        } catch (err) { showMessage('کێشەیەکا تۆڕێ هەیە.'); } finally { loading = false; }
    }

    async function fetchTrending() {
        if (loading || !youtubeApiKey || youtubeApiKey === 'Your_API_Key_Here') { showMessage('کلیلێ API یێ پێدڤیە.'); return; }
        loading = true; showLoader();
        try {
            const url = `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&chart=mostPopular&maxResults=15&regionCode=US&key=${youtubeApiKey}`;
            const response = await fetch(url);
            const data = await response.json();
            resultsDiv.innerHTML = '';
            if (data.error) { showMessage('کێشەیەک د ئینانا ترێندان دا هەیە.'); return; }
            data.items.forEach((video, index) => {
                const videoData = { id: { videoId: video.id }, snippet: video.snippet };
                resultsDiv.appendChild(createVideoCard(videoData, index, video.statistics));
            });
        } catch (err) { showMessage('کێشەیەکا تۆڕێ هەیە.'); } finally { loading = false; }
    }

    function createVideoCard(video, index, stats = {}) {
        const div = document.createElement('div');
        div.className = 'video-card';
        div.style.animationDelay = `${index * 80}ms`;
        const viewCount = stats.viewCount ? formatViews(stats.viewCount) : '';
        div.innerHTML = `
            <iframe src="https://www.youtube.com/embed/${video.id.videoId}" loading="lazy" allowfullscreen></iframe>
            <div class="video-card-content">
                <h4>${video.snippet.title}</h4>
                <div class="video-info">
                    <span>${video.snippet.channelTitle}</span>
                    ${viewCount ? `<span><i class="fas fa-eye"></i> ${viewCount}</span>` : ''}
                </div>
            </div>
        `;
        return div;
    }
    
    function formatViews(count) {
        if (!count) return '';
        if (count >= 1e6) return `${(count / 1e6).toFixed(1)}M`;
        if (count >= 1e3) return `${Math.round(count / 1e3)}K`;
        return count;
    }
    function showMessage(message) { resultsDiv.innerHTML = `<div class="message">${message}</div>`; }
    function showLoader() { resultsDiv.innerHTML = '<div class="loader">بارکرن...</div>'; }
    
    searchBtn.addEventListener('click', () => {
        const query = searchQueryInput.value.trim();
        if (query) performSearch(query);
    });
    searchQueryInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') { e.preventDefault(); searchBtn.click(); }
    });


  </script>
</body>
</html>